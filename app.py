from flask import Flask
from flask import render_template
from flask import request
from flask import redirect
import time
import nmap
import ports

app = Flask(__name__)

def nmap_ports(url):
    results = ports.main(url)
    return results

@app.route('/', methods=['GET', 'POST'])
def index():
    return render_template('index.html')

@app.route('/home', methods=['GET', 'POST'])
def home():
    return render_template('home.html')

@app.route('/code', methods=['GET', 'POST'], defaults={'url': "google.com"})
def code(url):
    url = "google.com"
    return render_template('code.html', targetUrl=url)

@app.route('/test', methods=['GET', 'POST'])
def test():
    if request.method == 'POST':
        url = request.form['url']
        # check if the url is valid
        if url:
            # check if it starts with http:// or https://
            if url.startswith('http://') or url.startswith('https://'):
                # remove http:// or https://
                url = url.split('://')[1]
                print(url)
                print('Calling a pentest function')
                # call the pentest function
                ports = nmap_ports(url)
                # Redirect after 120 seconds
                time.sleep(120)
                return redirect('/code')
            else:
                print(url)
                print('Calling a pentest function')
                return redirect('/code')
        else:
            print('No url')

        # return render_template('pentest.html')
    return render_template('test.html')

if __name__ == '__main__':
    app.run(port=5000, debug=True)
